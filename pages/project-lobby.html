<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מטפל לכל אחד - המיזם החברתי</title>
    <meta name="description" content="טיפול נפשי הוא זכות בסיסית, לא מותרות. מיזם חברתי המחבר בין מטפלים מוסמכים לאנשים הזקוקים לסיוע.">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --deep-petrol: #003B46;
            --muted-teal: #00606B;
            --dusty-aqua: #2F8592;
            --frost-white: #E8F1F2;
            --pure-white: #FFFFFF;
            --light-gray: #f8f9fa;
            --gold: #D4AF37;
            --gold-light: #e6c65a;
            --gold-glow: rgba(212, 175, 55, 0.3);
            --success: #00b894;
            --error: #e74c3c;
            --gradient-main: radial-gradient(ellipse at 30% 20%, #2F8592 0%, #00606B 40%, #003B46 100%);
            --gradient-gold: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Heebo', sans-serif;
            background: var(--frost-white);
            color: var(--deep-petrol);
            line-height: 1.7;
        }

        /* ===== Navbar ===== */
        .navbar {
            position: fixed;
            top: 0; right: 0; left: 0;
            z-index: 1000;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 59, 70, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(47, 133, 146, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            text-decoration: none;
            color: var(--pure-white);
        }

        .logo-icon {
            width: 45px; height: 45px;
            background: var(--gradient-gold);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: var(--deep-petrol);
        }

        .logo-text { font-size: 1.2rem; font-weight: 700; }
        .logo-text span { color: var(--gold); }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--frost-white);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover { color: var(--gold); }

        .nav-cta {
            background: var(--gradient-gold);
            color: var(--deep-petrol);
            padding: 0.6rem 1.4rem;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--gold-glow);
        }

        /* ===== Hero Section ===== */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-main);
            color: var(--pure-white);
            text-align: center;
            padding: 8rem 2rem 4rem;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 800px; height: 800px;
            background: radial-gradient(circle, var(--gold-glow) 0%, transparent 70%);
            opacity: 0.3;
            animation: pulse 8s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.15; }
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
        }

        .hero-icon {
            width: 100px; height: 100px;
            background: var(--gradient-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 2.5rem;
            color: var(--deep-petrol);
            box-shadow: 0 10px 40px var(--gold-glow);
        }

        .hero h1 {
            font-size: clamp(2.2rem, 5vw, 3.5rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }

        .hero h1 .highlight {
            color: var(--gold);
        }

        .hero-subtitle {
            font-size: 1.3rem;
            color: var(--frost-white);
            opacity: 0.95;
            max-width: 650px;
            margin: 0 auto 2.5rem;
            line-height: 1.8;
        }

        .hero-cta {
            display: inline-flex;
            align-items: center;
            gap: 0.7rem;
            padding: 1.2rem 3rem;
            background: var(--gradient-gold);
            color: var(--deep-petrol);
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            font-family: inherit;
            box-shadow: 0 8px 30px var(--gold-glow);
        }

        .hero-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px var(--gold-glow);
        }

        .hero-trust {
            margin-top: 3rem;
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .trust-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--frost-white);
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .trust-item i {
            color: var(--gold);
        }

        /* ===== How It Works ===== */
        .how-it-works {
            padding: 6rem 2rem;
            background: var(--pure-white);
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(47, 133, 146, 0.1);
            color: var(--dusty-aqua);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--deep-petrol);
            margin-bottom: 1rem;
        }

        .section-subtitle {
            font-size: 1.15rem;
            color: var(--muted-teal);
            max-width: 600px;
            margin: 0 auto;
        }

        .explanation-box {
            max-width: 800px;
            margin: 0 auto 4rem;
            background: linear-gradient(135deg, var(--deep-petrol) 0%, var(--muted-teal) 100%);
            color: var(--pure-white);
            padding: 2.5rem;
            border-radius: 20px;
            text-align: center;
        }

        .explanation-box h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: var(--gold);
        }

        .explanation-box p {
            font-size: 1.1rem;
            line-height: 1.8;
            opacity: 0.95;
        }

        .steps-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .step-card {
            text-align: center;
            padding: 2.5rem 2rem;
            background: var(--frost-white);
            border-radius: 20px;
            position: relative;
            transition: all 0.3s;
        }

        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 59, 70, 0.1);
        }

        .step-number {
            position: absolute;
            top: -20px;
            right: 50%;
            transform: translateX(50%);
            width: 45px; height: 45px;
            background: var(--gradient-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--deep-petrol);
            box-shadow: 0 4px 15px var(--gold-glow);
        }

        .step-icon {
            width: 80px; height: 80px;
            background: rgba(47, 133, 146, 0.1);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem auto 1.5rem;
            font-size: 2rem;
            color: var(--dusty-aqua);
        }

        .step-card h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--deep-petrol);
        }

        .step-card p {
            color: var(--muted-teal);
            font-size: 0.95rem;
        }

        /* ===== Form Section ===== */
        .form-section {
            padding: 6rem 2rem;
            background: var(--frost-white);
        }

        .form-container {
            max-width: 700px;
            margin: 0 auto;
            background: var(--pure-white);
            border-radius: 24px;
            box-shadow: 0 10px 50px rgba(0, 59, 70, 0.1);
            overflow: hidden;
        }

        .form-header {
            background: var(--gradient-main);
            color: var(--pure-white);
            padding: 2.5rem;
            text-align: center;
        }

        .form-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .form-header p {
            opacity: 0.9;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 1.5rem 2rem;
            background: rgba(0, 59, 70, 0.05);
            border-bottom: 1px solid rgba(47, 133, 146, 0.1);
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(47, 133, 146, 0.1);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--muted-teal);
            transition: all 0.3s;
        }

        .progress-step.active {
            background: var(--gradient-gold);
            color: var(--deep-petrol);
            font-weight: 600;
        }

        .progress-step.completed {
            background: var(--success);
            color: white;
        }

        .progress-step i {
            font-size: 0.8rem;
        }

        /* Form Content */
        .form-body {
            padding: 2.5rem;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-step h3 {
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
            color: var(--deep-petrol);
        }

        .form-step .step-desc {
            color: var(--muted-teal);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--deep-petrol);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 1rem 1.2rem;
            border: 2px solid rgba(47, 133, 146, 0.2);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
            background: var(--pure-white);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--dusty-aqua);
            box-shadow: 0 0 0 4px rgba(47, 133, 146, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Radio Options */
        .radio-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .radio-option {
            position: relative;
        }

        .radio-option input {
            position: absolute;
            opacity: 0;
        }

        .radio-option label {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 1rem;
            border: 2px solid rgba(47, 133, 146, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .radio-option label i {
            font-size: 1.5rem;
            color: var(--dusty-aqua);
            margin-bottom: 0.5rem;
        }

        .radio-option input:checked + label {
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.1);
        }

        .radio-option input:checked + label i {
            color: var(--gold);
        }

        /* Checkbox Group */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
        }

        .checkbox-option {
            position: relative;
        }

        .checkbox-option input {
            position: absolute;
            opacity: 0;
        }

        .checkbox-option label {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            padding: 1rem;
            border: 2px solid rgba(47, 133, 146, 0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .checkbox-option label::before {
            content: '';
            width: 22px; height: 22px;
            border: 2px solid rgba(47, 133, 146, 0.3);
            border-radius: 6px;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .checkbox-option input:checked + label {
            border-color: var(--dusty-aqua);
            background: rgba(47, 133, 146, 0.05);
        }

        .checkbox-option input:checked + label::before {
            background: var(--dusty-aqua);
            border-color: var(--dusty-aqua);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z'/%3E%3C/svg%3E");
            background-size: 14px;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Form Navigation */
        .form-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(47, 133, 146, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-family: inherit;
        }

        .btn-secondary {
            background: transparent;
            color: var(--muted-teal);
            border: 2px solid rgba(47, 133, 146, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(47, 133, 146, 0.1);
        }

        .btn-primary {
            background: var(--gradient-gold);
            color: var(--deep-petrol);
            box-shadow: 0 4px 15px var(--gold-glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--gold-glow);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Success State */
        .form-success {
            display: none;
            text-align: center;
            padding: 3rem;
        }

        .form-success.active {
            display: block;
        }

        .success-icon {
            width: 100px; height: 100px;
            background: linear-gradient(135deg, var(--success) 0%, #00cec9 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 3rem;
            color: white;
        }

        .form-success h3 {
            font-size: 1.8rem;
            color: var(--deep-petrol);
            margin-bottom: 1rem;
        }

        .form-success p {
            color: var(--muted-teal);
            font-size: 1.1rem;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ===== Footer ===== */
        .footer {
            background: var(--deep-petrol);
            color: var(--frost-white);
            padding: 3rem 2rem;
            text-align: center;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.7rem;
            margin-bottom: 1rem;
        }

        .footer-logo .logo-icon {
            width: 40px; height: 40px;
            background: var(--gradient-gold);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: var(--deep-petrol);
        }

        .footer-logo span {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .footer p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* ===== Responsive ===== */
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .hero h1 { font-size: 2rem; }
            .steps-grid { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
            .radio-group { grid-template-columns: 1fr; }
            .checkbox-group { grid-template-columns: 1fr; }
            .hero-trust { flex-direction: column; gap: 1rem; }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="../index.html" class="logo">
            <div class="logo-icon"><i class="fa-solid fa-heart-pulse"></i></div>
            <div class="logo-text">מטפל <span>לכל אחד</span></div>
        </a>
        <ul class="nav-links">
            <li><a href="../index.html">דף הבית</a></li>
            <li><a href="about.html">מי אנחנו</a></li>
            <li><a href="free-portal.html">קורס חינמי</a></li>
            <li><a href="training.html">הכשרת מטפלים</a></li>
        </ul>
        <a href="#form" class="nav-cta">בדיקת זכאות</a>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <div class="hero-icon">
                <i class="fa-solid fa-hands-holding-heart"></i>
            </div>
            <h1>טיפול נפשי הוא <span class="highlight">זכות בסיסית</span>,<br>לא מותרות.</h1>
            <p class="hero-subtitle">
                מיזם חברתי המחבר בין מטפלים מוסמכים לאנשים הזקוקים לסיוע -
                <strong>ב-100% מימון מלא שלנו.</strong>
            </p>
            <a href="#form" class="hero-cta">
                <i class="fa-solid fa-clipboard-check"></i>
                לבדיקת זכאות והתאמת מטפל
            </a>
            <div class="hero-trust">
                <div class="trust-item">
                    <i class="fa-solid fa-check-circle"></i>
                    <span>ללא עלות</span>
                </div>
                <div class="trust-item">
                    <i class="fa-solid fa-check-circle"></i>
                    <span>מטפלים מוסמכים</span>
                </div>
                <div class="trust-item">
                    <i class="fa-solid fa-check-circle"></i>
                    <span>פריסה ארצית</span>
                </div>
                <div class="trust-item">
                    <i class="fa-solid fa-check-circle"></i>
                    <span>דיסקרטיות מלאה</span>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works -->
    <section class="how-it-works">
        <div class="section-header">
            <div class="section-badge">
                <i class="fa-solid fa-info-circle"></i>
                איך זה עובד?
            </div>
            <h2 class="section-title">תהליך פשוט ומהיר</h2>
            <p class="section-subtitle">בשלושה צעדים פשוטים תתחילו את המסע שלכם לריפוי</p>
        </div>

        <div class="explanation-box">
            <h3>המיזם מיועד למי שאין לו יכולת כלכלית לטיפול פרטי</h3>
            <p>אנחנו דואגים לכל העלויות - המטפלים, המקום, הליווי. אתם דואגים להחלים ולהתקדם. זה הכל.</p>
        </div>

        <div class="steps-grid">
            <div class="step-card">
                <div class="step-number">1</div>
                <div class="step-icon">
                    <i class="fa-solid fa-clipboard-list"></i>
                </div>
                <h4>מלאו שאלון קצר</h4>
                <p>כמה שאלות פשוטות שיעזרו לנו להבין את הצרכים שלכם</p>
            </div>
            <div class="step-card">
                <div class="step-number">2</div>
                <div class="step-icon">
                    <i class="fa-solid fa-user-check"></i>
                </div>
                <h4>נתאים לכם מטפל</h4>
                <p>מטפל מקצועי ומנוסה שמתאים בדיוק לצרכים שלכם</p>
            </div>
            <div class="step-card">
                <div class="step-number">3</div>
                <div class="step-icon">
                    <i class="fa-solid fa-heart"></i>
                </div>
                <h4>צאו לדרך חדשה</h4>
                <p>התחילו תהליך טיפולי משמעותי לריפוי וצמיחה</p>
            </div>
        </div>
    </section>

    <!-- Form Section -->
    <section class="form-section" id="form">
        <div class="section-header">
            <div class="section-badge">
                <i class="fa-solid fa-pen"></i>
                הרשמה
            </div>
            <h2 class="section-title">בואו נתחיל</h2>
            <p class="section-subtitle">ספרו לנו קצת על עצמכם כדי שנוכל לעזור</p>
        </div>

        <div class="form-container">
            <div class="form-header">
                <h2>שאלון התאמה</h2>
                <p>כל המידע נשמר בסודיות מוחלטת</p>
            </div>

            <div class="progress-steps">
                <div class="progress-step active" data-step="1">
                    <i class="fa-solid fa-user"></i>
                    פרטים אישיים
                </div>
                <div class="progress-step" data-step="2">
                    <i class="fa-solid fa-heart"></i>
                    על הפנייה
                </div>
                <div class="progress-step" data-step="3">
                    <i class="fa-solid fa-sliders"></i>
                    העדפות
                </div>
            </div>

            <form id="patientForm" class="form-body">
                <!-- Step 1: Personal Info -->
                <div class="form-step active" data-step="1">
                    <h3>פרטים אישיים</h3>
                    <p class="step-desc">מידע בסיסי ליצירת קשר</p>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fullName">שם מלא *</label>
                            <input type="text" id="fullName" name="fullName" required placeholder="השם שלך">
                        </div>
                        <div class="form-group">
                            <label for="phone">טלפון *</label>
                            <input type="tel" id="phone" name="phone" required placeholder="050-0000000">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">אימייל</label>
                            <input type="email" id="email" name="email" placeholder="email@example.com">
                        </div>
                        <div class="form-group">
                            <label for="age">גיל *</label>
                            <select id="age" name="age" required>
                                <option value="">בחר/י</option>
                                <option value="18-25">18-25</option>
                                <option value="26-35">26-35</option>
                                <option value="36-45">36-45</option>
                                <option value="46-55">46-55</option>
                                <option value="56+">56+</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="city">עיר מגורים *</label>
                        <select id="city" name="city" required>
                            <option value="">בחר/י עיר</option>
                            <option value="תל אביב">תל אביב</option>
                            <option value="ירושלים">ירושלים</option>
                            <option value="חיפה">חיפה</option>
                            <option value="באר שבע">באר שבע</option>
                            <option value="ראשון לציון">ראשון לציון</option>
                            <option value="פתח תקווה">פתח תקווה</option>
                            <option value="נתניה">נתניה</option>
                            <option value="אשדוד">אשדוד</option>
                            <option value="other">אחר</option>
                        </select>
                    </div>
                    <div class="form-group" id="otherCityGroup" style="display: none;">
                        <input type="text" id="otherCity" placeholder="הזן את שם העיר">
                    </div>

                    <div class="form-nav">
                        <div></div>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            המשך
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: About the Request -->
                <div class="form-step" data-step="2">
                    <h3>ספרו לנו על הפנייה</h3>
                    <p class="step-desc">מה הביא אתכם אלינו?</p>

                    <div class="form-group">
                        <label>מה הנושאים העיקריים שהייתם רוצים לטפל בהם? *</label>
                        <div class="checkbox-group">
                            <div class="checkbox-option">
                                <input type="checkbox" id="topic1" name="topics" value="חרדה">
                                <label for="topic1">חרדה / לחץ</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="topic2" name="topics" value="דיכאון">
                                <label for="topic2">דיכאון / עצב</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="topic3" name="topics" value="טראומה">
                                <label for="topic3">טראומה / פוסט-טראומה</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="topic4" name="topics" value="יחסים">
                                <label for="topic4">קשיים בזוגיות / יחסים</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="topic5" name="topics" value="משבר">
                                <label for="topic5">משבר אישי / מעבר</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="topic6" name="topics" value="other">
                                <label for="topic6">אחר</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">ספרו קצת על מה שאתם עוברים (לא חובה)</label>
                        <textarea id="description" name="description" placeholder="כל מה שתרגישו נוח לשתף יעזור לנו להתאים לכם את המטפל הנכון..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="urgency">רמת הדחיפות</label>
                        <select id="urgency" name="urgency">
                            <option value="normal">רגיל - אפשר להמתין</option>
                            <option value="soon">מעדיף/ה בהקדם</option>
                            <option value="urgent">דחוף מאוד</option>
                        </select>
                    </div>

                    <div class="form-nav">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <i class="fa-solid fa-arrow-right"></i>
                            חזרה
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            המשך
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Preferences -->
                <div class="form-step" data-step="3">
                    <h3>העדפות</h3>
                    <p class="step-desc">איזה סוג טיפול מתאים לכם?</p>

                    <div class="form-group">
                        <label>העדפת מגדר המטפל/ת</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="genderMale" name="therapistGender" value="male">
                                <label for="genderMale">
                                    <i class="fa-solid fa-mars"></i>
                                    מטפל
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="genderFemale" name="therapistGender" value="female">
                                <label for="genderFemale">
                                    <i class="fa-solid fa-venus"></i>
                                    מטפלת
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="genderAny" name="therapistGender" value="any" checked>
                                <label for="genderAny">
                                    <i class="fa-solid fa-equals"></i>
                                    לא משנה
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>צורת הטיפול המועדפת</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="formatOnline" name="format" value="online">
                                <label for="formatOnline">
                                    <i class="fa-solid fa-video"></i>
                                    אונליין (זום)
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="formatInPerson" name="format" value="in-person">
                                <label for="formatInPerson">
                                    <i class="fa-solid fa-building"></i>
                                    פרונטלי
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="formatBoth" name="format" value="both" checked>
                                <label for="formatBoth">
                                    <i class="fa-solid fa-arrows-left-right"></i>
                                    גמיש
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="availability">מתי נוח לכם להיפגש?</label>
                        <select id="availability" name="availability">
                            <option value="">בחר/י</option>
                            <option value="morning">בוקר (8:00-12:00)</option>
                            <option value="afternoon">צהריים (12:00-17:00)</option>
                            <option value="evening">ערב (17:00-21:00)</option>
                            <option value="flexible">גמיש</option>
                        </select>
                    </div>

                    <div class="form-nav">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <i class="fa-solid fa-arrow-right"></i>
                            חזרה
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fa-solid fa-paper-plane"></i>
                            שלחו בקשה
                        </button>
                    </div>
                </div>
            </form>

            <!-- Success State -->
            <div class="form-success" id="formSuccess">
                <div class="success-icon">
                    <i class="fa-solid fa-check"></i>
                </div>
                <h3>הבקשה נשלחה בהצלחה!</h3>
                <p>ניצור איתך קשר תוך 48 שעות להתאמת מטפל. תודה על האמון.</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-logo">
            <div class="logo-icon"><i class="fa-solid fa-heart-pulse"></i></div>
            <span>מטפל לכל אחד</span>
        </div>
        <p>&copy; 2024 מטפל לכל אחד. כל הזכויות שמורות.</p>
    </footer>

    <script src="../js/marketing-tools.js"></script>
    <script src="../js/supabase-client.js"></script>
    <script>
        // ===== Configuration =====
        const SUPABASE_URL = 'https://eimcudmlfjlyxjyrdcgc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpbWN1ZG1sZmpseXhqeXJkY2djIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MTA5MDYsImV4cCI6MjA4NDk4NjkwNn0.ESXViZ0DZxopHxHNuC6vRn3iIZz1KZkQcXwgLhK_nQw';

        // ===== State =====
        let currentStep = 1;
        const totalSteps = 3;

        // ===== City Selection =====
        document.getElementById('city').addEventListener('change', function() {
            const otherGroup = document.getElementById('otherCityGroup');
            if (this.value === 'other') {
                otherGroup.style.display = 'block';
            } else {
                otherGroup.style.display = 'none';
            }
        });

        // ===== Step Navigation =====
        function nextStep() {
            if (!validateStep(currentStep)) return;

            if (currentStep < totalSteps) {
                currentStep++;
                updateFormUI();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateFormUI();
            }
        }

        function updateFormUI() {
            // Update step visibility
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');

            // Update progress indicators
            document.querySelectorAll('.progress-step').forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.remove('active', 'completed');
                if (stepNum === currentStep) {
                    step.classList.add('active');
                } else if (stepNum < currentStep) {
                    step.classList.add('completed');
                }
            });

            // Scroll to form
            document.getElementById('form').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function validateStep(step) {
            const currentStepEl = document.querySelector(`.form-step[data-step="${step}"]`);
            const requiredFields = currentStepEl.querySelectorAll('[required]');

            for (let field of requiredFields) {
                if (!field.value.trim()) {
                    field.focus();
                    field.style.borderColor = '#e74c3c';
                    setTimeout(() => field.style.borderColor = '', 2000);
                    return false;
                }
            }

            // Validate at least one topic selected in step 2
            if (step === 2) {
                const topics = document.querySelectorAll('input[name="topics"]:checked');
                if (topics.length === 0) {
                    alert('אנא בחרו לפחות נושא אחד');
                    return false;
                }
            }

            return true;
        }

        // ===== Form Submission =====
        document.getElementById('patientForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!validateStep(currentStep)) return;

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> שולח...';

            // Gather form data
            const formData = {
                full_name: document.getElementById('fullName').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim() || null,
                age_range: document.getElementById('age').value,
                city: document.getElementById('city').value === 'other'
                    ? document.getElementById('otherCity').value
                    : document.getElementById('city').value,
                topics: Array.from(document.querySelectorAll('input[name="topics"]:checked')).map(cb => cb.value),
                description: document.getElementById('description').value.trim() || null,
                urgency: document.getElementById('urgency').value,
                therapist_gender: document.querySelector('input[name="therapistGender"]:checked')?.value || 'any',
                format: document.querySelector('input[name="format"]:checked')?.value || 'both',
                availability: document.getElementById('availability').value || null
            };

            try {
                const supabase = window.supabaseClient || window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

                // Save to contact_requests (works for anonymous users)
                const { error } = await supabase
                    .from('contact_requests')
                    .insert({
                        full_name: formData.full_name,
                        phone: formData.phone,
                        email: formData.email,
                        request_type: 'patient',
                        city: formData.city,
                        status: 'new',
                        source: 'project-lobby-wizard',
                        message: JSON.stringify({
                            age_range: formData.age_range,
                            topics: formData.topics,
                            description: formData.description,
                            urgency: formData.urgency,
                            therapist_gender: formData.therapist_gender,
                            format: formData.format,
                            availability: formData.availability
                        })
                    });

                if (error) throw error;

                // Show success
                document.getElementById('patientForm').style.display = 'none';
                document.querySelector('.progress-steps').style.display = 'none';
                document.getElementById('formSuccess').classList.add('active');

            } catch (error) {
                console.error('Error submitting form:', error);
                alert('אירעה שגיאה בשליחה. אנא נסו שוב.');

                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> שלחו בקשה';
            }
        });

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.3)';
            } else {
                navbar.style.boxShadow = 'none';
            }
        });
    </script>
</body>
</html>
